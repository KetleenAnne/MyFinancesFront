{"ast":null,"code":"import _regeneratorRuntime from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import AuthService from'../app/service/authService';import jwt from'jsonwebtoken';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/React.createContext();export var AuthConsumer=AuthContext.Consumer;var AuthProvider=AuthContext.Provider;var AuthenticationProvider=/*#__PURE__*/function(_React$Component){_inherits(AuthenticationProvider,_React$Component);var _super=_createSuper(AuthenticationProvider);function AuthenticationProvider(){var _this;_classCallCheck(this,AuthenticationProvider);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={authenticatedUser:null,isAuthenticated:false,isLoading:true};_this.startSession=function(tokenDTO){var token=tokenDTO.token;var claims=jwt.decode(token);var user={id:claims.userid,name:claims.name};AuthService.login(user,token);_this.setState({isAuthenticated:true,authenticatedUser:user});};_this.closeSession=function(){AuthService.removeAuthenticatedUser();_this.setState({isAuthenticated:false,authenticatedUser:null});};return _this;}_createClass(AuthenticationProvider,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var isAuthenticated,user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:isAuthenticated=AuthService.isAuthenticatedUser();if(!isAuthenticated){_context.next=8;break;}_context.next=4;return AuthService.refreshSession();case 4:user=_context.sent;this.setState({isAuthenticated:true,authenticatedUser:user,isLoading:false});_context.next=9;break;case 8:this.setState(function(previousState){return _objectSpread(_objectSpread({},previousState),{},{isLoading:false});});case 9:case\"end\":return _context.stop();}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){if(this.state.isLoading){return null;}var context={authenticatedUser:this.state.authenticatedUser,isAuthenticated:this.state.isAuthenticated,startSession:this.startSession,closeSession:this.closeSession};return/*#__PURE__*/_jsx(AuthProvider,{value:context,children:this.props.children});}}]);return AuthenticationProvider;}(React.Component);export default AuthenticationProvider;","map":{"version":3,"names":["React","AuthService","jwt","AuthContext","createContext","AuthConsumer","Consumer","AuthProvider","Provider","AuthenticationProvider","state","authenticatedUser","isAuthenticated","isLoading","startSession","tokenDTO","token","claims","decode","user","id","userid","name","login","setState","closeSession","removeAuthenticatedUser","isAuthenticatedUser","refreshSession","previousState","context","props","children","Component"],"sources":["/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/src/main/authenticationProvider.js"],"sourcesContent":["import React from 'react'\n\nimport AuthService from '../app/service/authService'\nimport jwt from 'jsonwebtoken'\n\nexport const AuthContext = React.createContext()\nexport const AuthConsumer = AuthContext.Consumer;\n\nconst AuthProvider = AuthContext.Provider;\n\nclass AuthenticationProvider extends React.Component{\n\n    state = {\n        authenticatedUser: null,\n        isAuthenticated: false,\n        isLoading: true\n    }\n\n    startSession = (tokenDTO) => {\n        const token = tokenDTO.token\n        const claims = jwt.decode(token)\n        const user = {\n            id: claims.userid,\n            name: claims.name\n        }\n        \n        AuthService.login(user, token);\n        this.setState({ isAuthenticated: true, authenticatedUser: user })\n    }\n\n    closeSession= () => {\n        AuthService.removeAuthenticatedUser();\n        this.setState({ isAuthenticated: false, authenticatedUser: null})\n    }\n\n    async componentDidMount(){\n        const isAuthenticated = AuthService.isAuthenticatedUser()\n        if(isAuthenticated){\n            const user = await AuthService.refreshSession()\n            this.setState({\n                isAuthenticated: true,\n                authenticatedUser: user,\n                isLoading: false\n            })\n        }else{\n            this.setState( previousState => {\n                return {\n                    ...previousState,\n                    isLoading: false\n                }\n            })\n        }\n    }\n\n    render(){\n\n        if(this.state.isLoading){\n            return null;\n        }\n\n        const context = {\n            authenticatedUser: this.state.authenticatedUser,\n            isAuthenticated: this.state.isAuthenticated,\n            startSession: this.startSession,\n            closeSession: this.closeSession\n        }\n\n        return(\n            <AuthProvider value={context} >\n                {this.props.children}\n            </AuthProvider>\n        )\n    }\n}\n\nexport default AuthenticationProvider;"],"mappings":"w+BAAA,MAAOA,MAAK,KAAM,OAAO,CAEzB,MAAOC,YAAW,KAAM,4BAA4B,CACpD,MAAOC,IAAG,KAAM,cAAc,4CAE9B,MAAO,IAAMC,YAAW,cAAGH,KAAK,CAACI,aAAa,EAAE,CAChD,MAAO,IAAMC,aAAY,CAAGF,WAAW,CAACG,QAAQ,CAEhD,GAAMC,aAAY,CAAGJ,WAAW,CAACK,QAAQ,CAAC,GAEpCC,uBAAsB,uYAExBC,KAAK,CAAG,CACJC,iBAAiB,CAAE,IAAI,CACvBC,eAAe,CAAE,KAAK,CACtBC,SAAS,CAAE,IACf,CAAC,OAEDC,YAAY,CAAG,SAACC,QAAQ,CAAK,CACzB,GAAMC,MAAK,CAAGD,QAAQ,CAACC,KAAK,CAC5B,GAAMC,OAAM,CAAGf,GAAG,CAACgB,MAAM,CAACF,KAAK,CAAC,CAChC,GAAMG,KAAI,CAAG,CACTC,EAAE,CAAEH,MAAM,CAACI,MAAM,CACjBC,IAAI,CAAEL,MAAM,CAACK,IACjB,CAAC,CAEDrB,WAAW,CAACsB,KAAK,CAACJ,IAAI,CAAEH,KAAK,CAAC,CAC9B,MAAKQ,QAAQ,CAAC,CAAEZ,eAAe,CAAE,IAAI,CAAED,iBAAiB,CAAEQ,IAAK,CAAC,CAAC,CACrE,CAAC,OAEDM,YAAY,CAAE,UAAM,CAChBxB,WAAW,CAACyB,uBAAuB,EAAE,CACrC,MAAKF,QAAQ,CAAC,CAAEZ,eAAe,CAAE,KAAK,CAAED,iBAAiB,CAAE,IAAI,CAAC,CAAC,CACrE,CAAC,+KAED,6JACUC,eAAe,CAAGX,WAAW,CAAC0B,mBAAmB,EAAE,KACtDf,eAAe,+CACKX,YAAW,CAAC2B,cAAc,EAAE,QAAzCT,IAAI,eACV,IAAI,CAACK,QAAQ,CAAC,CACVZ,eAAe,CAAE,IAAI,CACrBD,iBAAiB,CAAEQ,IAAI,CACvBN,SAAS,CAAE,KACf,CAAC,CAAC,8BAEF,IAAI,CAACW,QAAQ,CAAE,SAAAK,aAAa,CAAI,CAC5B,sCACOA,aAAa,MAChBhB,SAAS,CAAE,KAAK,GAExB,CAAC,CAAC,2DAET,mIAED,iBAAQ,CAEJ,GAAG,IAAI,CAACH,KAAK,CAACG,SAAS,CAAC,CACpB,MAAO,KAAI,CACf,CAEA,GAAMiB,QAAO,CAAG,CACZnB,iBAAiB,CAAE,IAAI,CAACD,KAAK,CAACC,iBAAiB,CAC/CC,eAAe,CAAE,IAAI,CAACF,KAAK,CAACE,eAAe,CAC3CE,YAAY,CAAE,IAAI,CAACA,YAAY,CAC/BW,YAAY,CAAE,IAAI,CAACA,YACvB,CAAC,CAED,mBACI,KAAC,YAAY,EAAC,KAAK,CAAEK,OAAQ,UACxB,IAAI,CAACC,KAAK,CAACC,QAAQ,EACT,CAEvB,CAAC,oCA9DgChC,KAAK,CAACiC,SAAS,EAiEpD,cAAexB,uBAAsB"},"metadata":{},"sourceType":"module","externalDependencies":[]}