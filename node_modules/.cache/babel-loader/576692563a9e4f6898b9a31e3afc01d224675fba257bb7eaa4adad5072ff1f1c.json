{"ast":null,"code":"var _jsxFileName = \"/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/src/main/authenticationProvider.js\";\nimport React from 'react';\nimport AuthService from '../app/service/authService';\nimport jwt from 'jsonwebtoken';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/React.createContext();\nexport const AuthConsumer = AuthContext.Consumer;\nconst AuthProvider = AuthContext.Provider;\nclass AuthenticationProvider extends React.Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      authenticatedUser: null,\n      isAuthenticated: false,\n      isLoading: true\n    };\n    this.startSession = tokenDTO => {\n      const token = tokenDTO.token;\n      const claims = jwt.decode(token);\n      const user = {\n        id: claims.userid,\n        name: claims.name\n      };\n      AuthService.login(user, token);\n      this.setState({\n        isAuthenticated: true,\n        authenticatedUser: user\n      });\n    };\n    this.closeSession = () => {\n      AuthService.removeAuthenticatedUser();\n      this.setState({\n        isAuthenticated: false,\n        authenticatedUser: null\n      });\n    };\n  }\n  async componentDidMount() {\n    const isAuthenticated = AuthService.isAuthenticatedUser();\n    if (isAuthenticated) {\n      const user = await AuthService.refreshSession();\n      this.setState({\n        isAuthenticated: true,\n        authenticatedUser: user,\n        isLoading: false\n      });\n    } else {\n      this.setState(previousState => {\n        return {\n          ...previousState,\n          isLoading: false\n        };\n      });\n    }\n  }\n  render() {\n    if (this.state.isLoading) {\n      return null;\n    }\n    const context = {\n      authenticatedUser: this.state.authenticatedUser,\n      isAuthenticated: this.state.isAuthenticated,\n      startSession: this.startSession,\n      closeSession: this.closeSession\n    };\n    return /*#__PURE__*/_jsxDEV(AuthProvider, {\n      value: context,\n      children: this.props.children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 13\n    }, this);\n  }\n}\nexport default AuthenticationProvider;","map":{"version":3,"names":["React","AuthService","jwt","AuthContext","createContext","AuthConsumer","Consumer","AuthProvider","Provider","AuthenticationProvider","Component","state","authenticatedUser","isAuthenticated","isLoading","startSession","tokenDTO","token","claims","decode","user","id","userid","name","login","setState","closeSession","removeAuthenticatedUser","componentDidMount","isAuthenticatedUser","refreshSession","previousState","render","context","props","children"],"sources":["/home/ket/Documentos/JAVA/MyFinancesFront/my-finances-app/src/main/authenticationProvider.js"],"sourcesContent":["import React from 'react'\n\nimport AuthService from '../app/service/authService'\nimport jwt from 'jsonwebtoken'\n\nexport const AuthContext = React.createContext()\nexport const AuthConsumer = AuthContext.Consumer;\n\nconst AuthProvider = AuthContext.Provider;\n\nclass AuthenticationProvider extends React.Component{\n\n    state = {\n        authenticatedUser: null,\n        isAuthenticated: false,\n        isLoading: true\n    }\n\n    startSession = (tokenDTO) => {\n        const token = tokenDTO.token\n        const claims = jwt.decode(token)\n        const user = {\n            id: claims.userid,\n            name: claims.name\n        }\n        \n        AuthService.login(user, token);\n        this.setState({ isAuthenticated: true, authenticatedUser: user })\n    }\n\n    closeSession= () => {\n        AuthService.removeAuthenticatedUser();\n        this.setState({ isAuthenticated: false, authenticatedUser: null})\n    }\n\n    async componentDidMount(){\n        const isAuthenticated = AuthService.isAuthenticatedUser()\n        if(isAuthenticated){\n            const user = await AuthService.refreshSession()\n            this.setState({\n                isAuthenticated: true,\n                authenticatedUser: user,\n                isLoading: false\n            })\n        }else{\n            this.setState( previousState => {\n                return {\n                    ...previousState,\n                    isLoading: false\n                }\n            })\n        }\n    }\n\n    render(){\n\n        if(this.state.isLoading){\n            return null;\n        }\n\n        const context = {\n            authenticatedUser: this.state.authenticatedUser,\n            isAuthenticated: this.state.isAuthenticated,\n            startSession: this.startSession,\n            closeSession: this.closeSession\n        }\n\n        return(\n            <AuthProvider value={context} >\n                {this.props.children}\n            </AuthProvider>\n        )\n    }\n}\n\nexport default AuthenticationProvider;"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,OAAOC,WAAW,MAAM,4BAA4B;AACpD,OAAOC,GAAG,MAAM,cAAc;AAAA;AAE9B,OAAO,MAAMC,WAAW,gBAAGH,KAAK,CAACI,aAAa,EAAE;AAChD,OAAO,MAAMC,YAAY,GAAGF,WAAW,CAACG,QAAQ;AAEhD,MAAMC,YAAY,GAAGJ,WAAW,CAACK,QAAQ;AAEzC,MAAMC,sBAAsB,SAAST,KAAK,CAACU,SAAS;EAAA;IAAA;IAAA,KAEhDC,KAAK,GAAG;MACJC,iBAAiB,EAAE,IAAI;MACvBC,eAAe,EAAE,KAAK;MACtBC,SAAS,EAAE;IACf,CAAC;IAAA,KAEDC,YAAY,GAAIC,QAAQ,IAAK;MACzB,MAAMC,KAAK,GAAGD,QAAQ,CAACC,KAAK;MAC5B,MAAMC,MAAM,GAAGhB,GAAG,CAACiB,MAAM,CAACF,KAAK,CAAC;MAChC,MAAMG,IAAI,GAAG;QACTC,EAAE,EAAEH,MAAM,CAACI,MAAM;QACjBC,IAAI,EAAEL,MAAM,CAACK;MACjB,CAAC;MAEDtB,WAAW,CAACuB,KAAK,CAACJ,IAAI,EAAEH,KAAK,CAAC;MAC9B,IAAI,CAACQ,QAAQ,CAAC;QAAEZ,eAAe,EAAE,IAAI;QAAED,iBAAiB,EAAEQ;MAAK,CAAC,CAAC;IACrE,CAAC;IAAA,KAEDM,YAAY,GAAE,MAAM;MAChBzB,WAAW,CAAC0B,uBAAuB,EAAE;MACrC,IAAI,CAACF,QAAQ,CAAC;QAAEZ,eAAe,EAAE,KAAK;QAAED,iBAAiB,EAAE;MAAI,CAAC,CAAC;IACrE,CAAC;EAAA;EAED,MAAMgB,iBAAiB,GAAE;IACrB,MAAMf,eAAe,GAAGZ,WAAW,CAAC4B,mBAAmB,EAAE;IACzD,IAAGhB,eAAe,EAAC;MACf,MAAMO,IAAI,GAAG,MAAMnB,WAAW,CAAC6B,cAAc,EAAE;MAC/C,IAAI,CAACL,QAAQ,CAAC;QACVZ,eAAe,EAAE,IAAI;QACrBD,iBAAiB,EAAEQ,IAAI;QACvBN,SAAS,EAAE;MACf,CAAC,CAAC;IACN,CAAC,MAAI;MACD,IAAI,CAACW,QAAQ,CAAEM,aAAa,IAAI;QAC5B,OAAO;UACH,GAAGA,aAAa;UAChBjB,SAAS,EAAE;QACf,CAAC;MACL,CAAC,CAAC;IACN;EACJ;EAEAkB,MAAM,GAAE;IAEJ,IAAG,IAAI,CAACrB,KAAK,CAACG,SAAS,EAAC;MACpB,OAAO,IAAI;IACf;IAEA,MAAMmB,OAAO,GAAG;MACZrB,iBAAiB,EAAE,IAAI,CAACD,KAAK,CAACC,iBAAiB;MAC/CC,eAAe,EAAE,IAAI,CAACF,KAAK,CAACE,eAAe;MAC3CE,YAAY,EAAE,IAAI,CAACA,YAAY;MAC/BW,YAAY,EAAE,IAAI,CAACA;IACvB,CAAC;IAED,oBACI,QAAC,YAAY;MAAC,KAAK,EAAEO,OAAQ;MAAA,UACxB,IAAI,CAACC,KAAK,CAACC;IAAQ;MAAA;MAAA;MAAA;IAAA,QACT;EAEvB;AACJ;AAEA,eAAe1B,sBAAsB"},"metadata":{},"sourceType":"module","externalDependencies":[]}